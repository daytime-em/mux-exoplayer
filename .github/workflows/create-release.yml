name: Create Draft Release

on:
  pull_request:
    types: [closed]

jobs:
  draft:
    # TODO: Only on merged, once it works
    #if: startsWith(github.head_ref, 'releases/v') && github.event.pull_request.merged
    if: startsWith(github.head_ref, 'releases/v')
    runs-on: ubuntu-latest
    name: Draft a new release with the release notes from PR (TRY GETTING FROM CONTEXT)
    steps:
     - name: Generate Version for ${{ github.head_ref }}
       id: version
       uses: AsasInnab/regex-action@v1
       with:
         regex_pattern: v\d+\.\d+\.\d+
         regex_flags: "gim"
         search_string: ${{ github.head_ref }}
     - name: Draft a release of (TODO TRY GETTING FROM CONTEXT)
       uses: actions/create-release@v1
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       with:
         tag_name: ${{ steps.version.outputs.first_match }}
         title: ${{ github.event.pull_request.title }}
         release_name: ${{ steps.version.outputs.first_match }}
         body: ${{ github.event.pull_request.body }}
         commitish: ${{ github.event.pull_request.head.sha }}
         draft: true
